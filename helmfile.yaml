helmDefaults:
  timeout: 600
  recreatePods: false
  tillerless: false

environments:
  default:
    values:
    - {{ requiredEnv "ENV_DIR" }}/values.yaml.gotmpl

repositories:
{{- range .Values }}
{{- if and (.enabled) (hasKey . "repository") }}
  - name: {{ .repository.name }}
    url: {{ .repository.url }}
{{- end }}
{{- end }}


releases:
  ## A special case where we want to load
{{- if or (.Values.certManager.enabled) (.Values.externalDNS.enabled) }}
  ## Mystique is a chart embedded in this repo that can be used to create
  ## general kubernetes resources such as secrets from files as shown here
  - name: cluster-system-extras
    namespace: cluster-system
    chart: ./charts/mystique
    values:
      - values/cluster-system/extras.yaml.gotmpl
{{- end }}

{{- if .Values.elasticsearch.enabled }}
  - name: elasticsearch-secrets
    namespace: {{ .Values.elasticsearch.namespace }}
    chart: ./charts/mystique
    values:
      - values/elasticsearch/secrets.yaml.gotmpl
{{- end }}

{{- if and (.Values.harbor.enabled) (or (not .Values.ingress.enabled) (env "UAA_ROOT_CA_CERT")) }}
  - name: harbor-secrets
    namespace: {{ .Values.harbor.namespace }}
    chart: ./charts/mystique
    values:
      - values/harbor/secrets.yaml.gotmpl
{{- end }}
{{- if .Values.spinnaker.enabled }}
  - name: spinnaker-secrets
    namespace: {{ .Values.spinnaker.namespace }}
    chart: ./charts/mystique
    values:
      - values/spinnaker/secrets.yaml.gotmpl
{{- end }}

{{- range .Values }}
{{- if .enabled }}
  - name: {{ .name }}
    namespace: {{ .namespace }}
    chart: {{ .chart }}
    version: "{{ .version }}"
    values:
    {{- range .values }}
      - {{ . }}
    {{- end }}
{{- end }}
{{- end }}
